<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.118.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="../../../images/favicon.png" type="image/png">

    <title>Geo Location Redirects :: AWS System Manager</title>

    
    <link href="../../../css/nucleus.css?1694075433" rel="stylesheet">
    <link href="../../../css/fontawesome-all.min.css?1694075433" rel="stylesheet">
    <link href="../../../css/hybrid.css?1694075433" rel="stylesheet">
    <link href="../../../css/featherlight.min.css?1694075433" rel="stylesheet">
    <link href="../../../css/perfect-scrollbar.min.css?1694075433" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1694075433" rel="stylesheet">
    <link href="../../../css/atom-one-dark-reasonable.css?1694075433" rel="stylesheet">
    <link href="../../../css/theme.css?1694075433" rel="stylesheet">
    <link href="../../../css/hugo-theme.css?1694075433" rel="stylesheet">
    
    <link href="../../../css/theme-workshop.css?1694075433" rel="stylesheet">
    
    

    <script src="../../../js/jquery-3.3.1.min.js?1694075433"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="../../../vi/3-cache/3.2-geored/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="../../../">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../../js/lunr.min.js?1694075433"></script>
<script type="text/javascript" src="../../../js/auto-complete.js?1694075433"></script>
<script type="text/javascript">
    
        var baseurl = "\/vi";
    
</script>
<script type="text/javascript" src="../../../js/search.js?1694075433"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-setup/" title="Account and Environment Setup" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/1-setup/">
           <b> 1. </b> Account and Environment Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-cache/" title="Trường hợp cho Cacheable" class="dd-item 
        parent
        
        
        ">
      <a href="../../../vi/3-cache/">
           <b> 3. </b> Trường hợp cho Cacheable
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-cache/3.1-urired/" title="URI based Redirects" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/3-cache/3.1-urired/">
           <b> 3.1. </b> URI based Redirects
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-cache/3.2-geored/" title="Geo Location Redirects" class="dd-item 
        
        active
        
        ">
      <a href="../../../vi/3-cache/3.2-geored/">
           <b> 3.2. </b> Geo Location Redirects
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-cache/3.3-devicered/" title="Device Redirects" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/3-cache/3.3-devicered/">
           <b> 3.3. </b> Device Redirects
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-cache/3.4-urirew/" title="URI based Rewrites" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/3-cache/3.4-urirew/">
           <b> 3.4. </b> URI based Rewrites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-terminate/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/4-terminate/">
           <b> 4. </b> Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/3-cache/3.2-geored/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/3-cache/3.2-geored/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-01-2022</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="#"  style="color:orange">Hoàng Kha</a> <br>
                <a href="https://www.linkedin.com/in/l%C3%AA-ngh%C4%A9a-43075a197/"  style="color:orange">Minh nghĩa</a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../../vi/'>Tối ưu hóa cho Serverless (Performance and Cost)</a> > <a href='../../../vi/3-cache/'>Trường hợp cho Cacheable</a> > Geo Location Redirects
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Geo Location Redirects
            </h1>
          

        



	<p>Trường hợp này thường được dùng để redirect viewer đến country page của website của chúng ta. Ở sơ đồ dưới đây, chúng ta có thể thấy cấu trúc được build cho phần này.</p>
<p><img src="../../../images/3.cache/3.2-geored/3.2-chart1.png" alt="bổ sung">
<img src="../../../images/3.cache/3.2-geored/3.2-chart2.png" alt="bổ sung"></p>
<h4 id="step-1-tạo-cloudfront-cache-policy-để-chuyển-tiếp-country-header">Step 1: Tạo CloudFront Cache policy để chuyển tiếp country header:</h4>
<p>Để có thể Redirect user dựa vào <strong>country location</strong>. Chúng ta cần đảm bảo rằng <strong>Contry Headeer</strong> liên kết với Lambda@Edge function. Để làm được điều này, chúng ta cần tạo <strong>Cache Policy</strong> nơi header được thêm vào cache key.</p>
<ol>
<li>
<p>Đến trang <a href="https://us-east-1.console.aws.amazon.com/cloudfront/v3/home?region=us-east-1#/policies/cache">CloudFront Cache Policies console</a>.</p>
</li>
<li>
<p>Ở mục <strong>Custom Policies,</strong> click vào nút <strong>Create cache policy</strong>.</p>
</li>
</ol>
<p><img src="../../../images/3.cache/3.2-geored/3.2-1new.png" alt="bổ sung"></p>
<ol start="3">
<li>Ở trang <strong>Create cache policy</strong>, đặt tên cho nó là <strong>edge-redirect-cache-policy</strong>. Ở phần <strong>Cache key settings</strong>, mở rộng phần <strong>Headers</strong> ra và chọn <strong>Include the following headers</strong>. Ở phần <strong>Add header</strong>, chúng ta tìm kiếm <strong>CloudFront-Viewer-Country</strong> và chọn nó. Những mục khác chúng ta để mặc định và click vào nút <strong>Create</strong>.</li>
</ol>
<p><img src="../../../images/3.cache/3.2-geored/3.2-2new.png" alt="bổ sung"></p>
<h4 id="step-2-tạo-lambdaedge-function-và-publish-new-version">Step 2: Tạo Lambda@Edge function và publish new version</h4>
<p>Ở bước này, chúng ta sẽ làm như ở phần trước, tạo <strong>Lambda function</strong> với tên <code>edge-geo-redirect</code>, <strong>Runtime</strong> là <strong>Python 3.9</strong> và deploy nó. Sau đó, chúng ta cần publish new version của Lambda function vừa tạo.</p>
<p>Code source của Lambda function này là:</p>
<pre tabindex="0"><code>import json
def lambda_handler(event, context):
    #Let&#39;s first get the Country Code from the Request coming in
    get_country_viewer_header = event[&#39;Records&#39;][0][&#39;cf&#39;][&#39;request&#39;][&#39;headers&#39;][&#39;cloudfront-viewer-country&#39;]
    define_country = get_country_viewer_header[0][&#39;value&#39;]
    #Now let&#39;s define which country that is and create our redirected response
    if (define_country == &#39;US&#39;):
        response = {
            &#39;status&#39;: &#39;301&#39;,
            &#39;statusDescription&#39;: &#39;Permanent Redirect&#39;,
            &#39;headers&#39;: {
                &#39;location&#39;: [{
                    &#39;key&#39;: &#39;Location&#39;,
                    &#39;value&#39;: &#39;/en-us.html&#39;
                }]
            }
        }
        #The response above has been created and a response will be sent to the viewer to redirect it to the /en-us.html
        return response
    else:
        #if the country has not been identified then move on with the request
        request = event[&#39;Records&#39;][0][&#39;cf&#39;][&#39;request&#39;]
        return request
</code></pre><h4 id="step-3-tạo-cloudfront-behavior-cho-trường-hợp-này">Step 3: Tạo CloudFront behavior cho trường hợp này</h4>
<p>Bây giờ Lambda function vừa được tạo và chúng ta phải assign nó cho một Cache Behavior trong CloudFront.</p>
<ol>
<li>
<p>Đi đến <a href="https://us-east-1.console.aws.amazon.com/cloudfront/v3/home">CloudFront console</a>. Các bạn sẽ thấy Distribution được tạo ra bởi CloudFormation template, nó sẽ được xác định bởi <strong>Edge Redirect Workshop Distribution</strong> như ở mục <strong>Description</strong>.</p>
</li>
<li>
<p>Chọn Distribution đó sau đó chọn vào mục <strong>Behaviors.</strong></p>
</li>
<li>
<p>Click vào nút <strong>Create Behavior.</strong></p>
</li>
<li>
<p>Ở mục <strong>Path pattern,</strong> chúng ta nhập <code>/geo.html</code>. Ở dưới là phần <strong>Origin and origin groups,</strong> chúng ta chọn <strong>myS3Origin.</strong> Ở phần <strong>Viewer protocol policy,</strong> chúng ta chọn <strong>Redirect HTTP to HTTPS.</strong> Ở mục <strong>Cache key and origin requests</strong>, chúng ta chọn <strong>Cache policy and origin request policy</strong>, tiếp theo mở rộng mục <strong>Cache policy</strong>, chúng ta chọn policy vừa tạo ở bước trên <strong>edge-redirect-cache-policy.</strong> Những mục còn lại chúng ta sẽ để mặc định và click vào nút <strong>Create behavior</strong> ở cuối trang.</p>
</li>
</ol>
<p><img src="../../../images/3.cache/3.2-geored/3.2-3new.png" alt="bổ sung"></p>
<h4 id="step-4-kết-hợp-lambda-function-với-cloudfront-behavior">Step 4: Kết hợp Lambda Function với CloudFront Behavior</h4>
<p>Chúng ta làm như ở trường hợp <strong>URI based Redirects</strong> ở trên, chúng ta sẽ kết hợp Lambda function <strong>edge-geo-redirect</strong> với CloudFront Behavior vừa tạo ở trên.</p>
<h4 id="step-5-set-up-clients-cho-testing">Step 5: Set up clients cho testing</h4>
<p>Chúng ta sẽ cần một client để chạy curl commands. Cách dễ dàng đó là tạo <strong>CloudShell Environments</strong>. CloudShell là một shell có sẵn trong AWS console và chúng ta có thể chạy những Linux command từ nó. Đi đến <a href="https://us-east-1.console.aws.amazon.com/cloudshell/home?region=us-east-1#">CloudShell Console</a> và chờ đến khi terminal sẵn sàng để dùng.</p>

<div class="notices info" ><p>Nếu CloudShell không hoạt động thì nếu bạn đang thực hành bài workshop này ở Linux/MacOS client thì hai hệ điều hành này đã có sẵn <strong>curl</strong> và bạn chỉ cần chạy command ở client đó. Nếu bạn đang thực hành trên Windows thì hãy tận dùng online curl tools như <a href="https://reqbin.com/curl">cái này</a>. Có thể chạy EC2 instance hoặc Cloud9 IDE từ AWS COnsole để chạy commands.</p>
</div>

<h4 id="step-6-test-redirect-configuration">Step 6: Test redirect configuration</h4>
<ol>
<li>
<p>Đi đến <a href="https://us-east-1.console.aws.amazon.com/cloudshell/home?region=us-east-1#">CloudShell Console</a> ở AWS Region <strong>us-east-1</strong>.</p>
</li>
<li>
<p>Trong phần test, chúng ta sẽ chạy câu lệnh curl để gửi http request đối với distribution của chúng ta, để làm như vậy, chúng ta cần copy Distribution domain name từ CloudFront console nơi chúng ta có thể tìm thấy.</p>
</li>
</ol>
<p><img src="../../../images/3.cache/3.1-urired/3.1-13new.png" alt="VPC"></p>
<p>Khi đã tìm thấy distribution domain name, copy câu lệnh sau và thay thế domain name của chúng ta vào.</p>
<pre tabindex="0"><code>curl -v -o /dev/null https://&lt;YOUR-DISTRIBUTION-DOMAIN-NAME&gt;/geo.html
</code></pre><ol start="3">
<li>Sau khi build câu lệnh trên từ cloudshell, chúng ta sẽ thấy kết quả như dưới đây.</li>
</ol>
<pre tabindex="0"><code>&lt; HTTP/1.1 301 Moved Permanently
&lt; Content-Length: 0
&lt; Connection: keep-alive
&lt; Server: CloudFront
&lt; Location: /en-us.html
&lt; X-Cache: Miss from cloudfront
&lt; Via: 1.1 6fbeae74487f866b555dc44d03fcc2a6.cloudfront.net (CloudFront)
&lt; X-Amz-Cf-Pop: MIA3-P3
&lt; X-Amz-Cf-Id: VRNhLpCaNiZ08Fw5f2eMtWn8KfHnkPp3qp4kQeft3CVfEjo6kXIEWQ==
</code></pre><ol start="4">
<li>Hãy chạy lại câu lệnh trên một lần nữa ở AWS Region <strong>us-east-1</strong>. Chúng ta sẽ thấy response khác nhau.</li>
</ol>
<pre tabindex="0"><code>&lt; HTTP/1.1 301 Moved Permanently
&lt; Content-Length: 0
&lt; Connection: keep-alive
&lt; Server: CloudFront
&lt; Location: /en-us.html
&lt; X-Cache: Hit from cloudfront
&lt; Via: 1.1 e759cef9ef04dc6632a71818dfac3a76.cloudfront.net (CloudFront)
&lt; X-Amz-Cf-Pop: MIA3-P3
&lt; X-Amz-Cf-Id: aOe3ADve7yDyHH_Iyb7MGMPAX8LWuTli79qf-nFl8rT40-VxPb_Zeg==
&lt; Age: 158
</code></pre>
<div class="notices info" ><p>Chỉ có sự khác biệt ở đây là <strong>X-Cache</strong> response header. Chúng ta sẽ thấy <strong>Hit from cloudfront</strong> vì ở response đầu tiên sau khi request, nó đã được cache ở CloudFront nên request thứ hai sẽ không cần phải đi qua tất cả function thay vào đó nó sẽ chỉ được hoạt đồng từ cached content, điều này cung cấp hiệu suất tốt hơn và cũng giúp tiết kiệm chi phí vì function không cần trigger lần nữa.</p>
</div>

<ol start="5">
<li>Bây giờ, quay trở lại shell console và chạy cùng câu lệnh trên ở AWS Region <strong>eu-west-1</strong>. Bây giờ response của chúng ta sẽ không phải là <strong>HTTP 301</strong> mà là <strong>HTTP 200 OK</strong> như dưới đây.</li>
</ol>
<pre tabindex="0"><code>&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html
&lt; Content-Length: 98
&lt; Connection: keep-alive
&lt; ETag: &#34;be3c901839ae019e0c58908e45f5ab45&#34;
&lt; Accept-Ranges: bytes
&lt; Server: AmazonS3
&lt; X-Cache: Miss from cloudfront
&lt; Via: 1.1 9bbdfc2323989883f386114cc53fdbd0.cloudfront.net (CloudFront)
&lt; X-Amz-Cf-Pop: MIA3-P3
&lt; X-Amz-Cf-Id: 2UlANwUbwF5Mv1V-XKWcYWKrTzIJZh2asxxw_xOK7aahkVP6TS6tRg==
&lt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;

&lt;h1&gt;Not our US page&lt;/h1&gt;
&lt;p&gt;Not our US page&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<div class="notices info" ><p>Response HTTP 200 OK của request này nghĩa là nó không được redirected và thay vào đó, resouce được request đã được CloudFront cung cấp.</p>
</div>

<p>Vậy là chúng ta đã deploy thành công redirect logic sử dụng Lambda@Edge và đã test xong. Trường hợp này có thể mở rộng ra phức tạp hơn, xác định không chỉ ở <strong>Contry</strong> mà còn cả các vị trí địa lí khác như <strong>States, Cities, postal codes, time zone</strong>. Tham khảo <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-cloudfront-headers.html#cloudfront-headers-viewer-location">tài liệu này</a> để tìm hiểu thêm về tất cả header location có thể có trong CloudFront.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../../vi/3-cache/3.1-urired/" title="URI based Redirects"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../../vi/3-cache/3.3-devicered/" title="Device Redirects" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../../js/clipboard.min.js?1694075433"></script>
    <script src="../../../js/perfect-scrollbar.min.js?1694075433"></script>
    <script src="../../../js/perfect-scrollbar.jquery.min.js?1694075433"></script>
    <script src="../../../js/jquery.sticky.js?1694075433"></script>
    <script src="../../../js/featherlight.min.js?1694075433"></script>
    <script src="../../../js/highlight.pack.js?1694075433"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../../js/modernizr.custom-3.6.0.js?1694075433"></script>
    <script src="../../../js/learn.js?1694075433"></script>
    <script src="../../../js/hugo-learn.js?1694075433"></script>

    <link href="../../../mermaid/mermaid.css?1694075433" rel="stylesheet" />
    <script src="../../../mermaid/mermaid.js?1694075433"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
